---
title: "9:13:53 AM - October 31, 2025"
date: 2025-10-30T20:13:53.229Z
timestamp: 1761855233229
---

## Project Notes

**ROOT CAUSE IDENTIFIED**

The profile provider issue is caused by a mismatch between Riverpod's reactive model and the service's batch fetch pattern:

1. **fetchUserProfileProvider** calls `userProfileService.fetchProfile(pubkey)`
2. **fetchProfile()** returns immediately with `null` if profile not cached (line 244)
3. Profile fetch happens asynchronously in batched debounced timer (100ms delay)
4. When batch completes, profiles are cached in UserProfileService
5. BUT the Riverpod provider has already completed with `null` - it never knows the profile arrived!

The fix: UserProfileService needs to notify Riverpod providers when profiles arrive from batch fetches. Options:

**Option A**: Make `fetchProfile()` return a Future that completes when the batch fetch finishes (not just immediately)
**Option B**: Have UserProfileService invalidate the Riverpod provider when profiles arrive
**Option C**: Switch to a streaming/reactive pattern where the provider watches profile updates

Option A seems cleanest - make fetchProfile return a proper Future that completes after the batch.
